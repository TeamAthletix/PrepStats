"use strict";(()=>{var e={};e.id=482,e.ids=[482],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7178:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>p,originalPathname:()=>c,requestAsyncStorage:()=>n,routeModule:()=>l,serverHooks:()=>d,staticGenerationAsyncStorage:()=>u,staticGenerationBailout:()=>_});var i={};a.r(i),a.d(i,{POST:()=>POST}),a(8976);var s=a(884),r=a(6132),o=a(5798);async function POST(e){let t={},{data:a}=await t.auth.getUser(),i=a?.user?.id;if(!i)return o.Z.json({error:"Unauthorized"},{status:401});let s=await e.json().catch(()=>({})),r=s.athlete_user_id,l=Number(s.team_id)||null,n=Number(s.org_id)||null,u=!!s.pin,{data:d}=await t.from("user_roles").select("role,status").eq("user_id",i),p=d?.some(e=>"coach"===e.role&&"active"===e.status),_=d?.some(e=>"media"===e.role&&"active"===e.status),c=!1;if(p&&l){let{data:e}=await t.from("spotlight_free_allocations_team").select("*").eq("team_id",l).eq("consumed",!1).limit(1).single();if(e){let e=await {};e&&(c=!0)}}if(!c&&_&&n){let{data:e}=await t.from("organizations").select("id,whitelisted").eq("id",n).single(),a=e?.whitelisted??!1;if(a){let{data:e}=await t.from("spotlight_free_allocations_org").select("*").eq("org_id",n).eq("consumed",!1).limit(1).single();if(e){let e=await {};e&&(c=!0)}}}if(!c)try{await {}}catch(e){return o.Z.json({error:e?.message??"Insufficient tokens"},{status:400})}let g=new Date().toISOString(),{data:m,error:h}=await t.from("spotlight_edits").insert({athlete_user_id:r,created_by_uuid:i,org_id:n||null,team_id:l||null,type:"spotlight",pinned:u,created_at:g,expires_at:null,share_url:null}).select("id").single();return h?o.Z.json({error:h.message},{status:400}):o.Z.json({ok:!0,spotlight_id:m?.id})}let l=new s.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/spotlight/edit/route",pathname:"/api/spotlight/edit",filename:"route",bundlePath:"app/api/spotlight/edit/route"},resolvedPagePath:"/workspaces/PrepStats/src/app/api/spotlight/edit/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:n,staticGenerationAsyncStorage:u,serverHooks:d,headerHooks:p,staticGenerationBailout:_}=l,c="/api/spotlight/edit/route"}};var t=require("../../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[364,798],()=>__webpack_exec__(7178));module.exports=a})();